generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  stripeId      String?   @unique
  subscription  Subscription?
  companies     Company[]
  signals       Signal[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Subscription {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])
  plan          String   // 'starter', 'pro', 'team'
  status        String   // 'active', 'canceled', 'past_due'
  currentPeriodEnd DateTime
  stripeSubscriptionId String? @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Company {
  id            String   @id @default(cuid())
  name          String
  domain        String?  @unique
  crunchbaseId  String?
  linkedinUrl   String?
  industry      String?
  employeeCount Int?
  fundingStage  String?  // 'seed', 'series_a', 'series_b', 'series_c', 'public'
  lastFundingAmount Int?
  lastFundingDate DateTime?
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  signals       Signal[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([userId])
  @@index([fundingStage])
}

model Signal {
  id            String   @id @default(cuid())
  type          String   // 'funding', 'hiring', 'expansion', 'news'
  title         String
  description   String?
  source        String   // 'crunchbase', 'linkedin', 'press', 'twitter'
  url           String?
  companyId     String
  company       Company  @relation(fields: [companyId], references: [id])
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  metadata      Json?    // Additional data like amount, role, location
  notified      Boolean  @default(false)
  notifiedAt    DateTime?
  createdAt     DateTime @default(now())
  
  @@index([companyId])
  @@index([userId])
  @@index([type])
  @@index([createdAt])
}

model Webhook {
  id            String   @id @default(cuid())
  type          String   // 'stripe', 'apify', 'slack'
  url           String
  secret        String?
  events        String[] // Event types to listen for
  active        Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}